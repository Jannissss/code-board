<!DOCTYPE html>
<html>
<head>
    <title>Code Snippet Board</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        .tile { border: 1px solid #ccc; padding: 10px; margin: 10px; cursor: pointer; }
        .modal { display: none; position: fixed; top: 0; left: 0;
                 width: 100%; height: 100%; background: rgba(0,0,0,0.5);
                 justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 20px; width: 80%; }
        .close { float: right; cursor: pointer; }
    </style>
</head>
<body>
    <button onclick="openAddModal()">‚ûï Add Snippet</button>
    <div id="tiles">
        {% for s in snippets %}
        <div class="tile" onclick="openSnippet({{ s.id }})">
            <pre><code class="{{ s.language }}">{{ s.code }}</code></pre>
            <button onclick="deleteSnippet(event, {{ s.id }})">üóëÔ∏è Delete</button>
        </div>
        {% endfor %}
    </div>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddModal()">‚úñ</span>
            <textarea id="newCode" rows="10" cols="50"></textarea><br>
            <input id="language" placeholder="Language (optional)">
            <button onclick="saveSnippet()">Save</button>
        </div>
    </div>

    <div id="snippetModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSnippetModal()">‚úñ</span>
            <pre><code id="snippetCode"></code></pre>
        </div>
    </div>

    <script>
        hljs.highlightAll();

        function openAddModal() {
            document.getElementById("addModal").style.display = "flex";
        }
        function closeAddModal() {
            document.getElementById("addModal").style.display = "none";
        }
        function saveSnippet() {
            fetch("/add", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    code: document.getElementById("newCode").value,
                    language: document.getElementById("language").value
                })
            }).then(() => location.reload());
        }
        function openSnippet(id) {
            const tile = document.querySelector(`.tile:nth-child(${id+1}) code`);
            document.getElementById("snippetCode").textContent = tile.textContent;
            hljs.highlightElement(document.getElementById("snippetCode"));
            document.getElementById("snippetModal").style.display = "flex";
        }
        function closeSnippetModal() {
            document.getElementById("snippetModal").style.display = "none";
        }
        function deleteSnippet(event, id) {
            event.stopPropagation();
            fetch(`/delete/${id}`, {method: "POST"}).then(() => location.reload());
        }
    </script>
</body>
</html>
